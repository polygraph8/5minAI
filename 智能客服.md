## 5分钟NLP-智能客服

[toc]



## 一、智能客服需要解决的问题

1、如何学习知识，构建知识库（包括但不限于问答库、知识图谱、领域词表等）

2、如何问答，用户问题的意图识别，答案选择以及如何结合上下文进行多轮交互。

3、如何持续学习，持续运营的需要，涉及的挑战包括未知问题识别，知识的自动更新和补充。 



## 二、智能客服体系结构

智能问答系统包括问答系统，知识维护和模型训练和NLP 4部分：

![image-20201120050200366](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/image-20201120050200366.png)



### **2.1 NLP**

1、基础算法

​     纠错、分词、实体识别、知识图谱、词法分析，情感分析

2、 深度语义匹配模型核心组件，意图识别，阅读理解

### **2.2 问答系统**

#### 2.2.1 意图识别

##### 1 词表列举法

通过词表直接匹配的方式来获取查询意图
例如查询词：德国[addr] 爱他美[brand] 奶粉[product] 三段[attr]
查询模式：[brand]+[product];[product]+[attr];[brand]+[product]+[attr]

```
Term Weight
引入词权重Term Weight，给词不同的打分，根据分值就可以判断出核心词，进而可以应用到不同的场景。
比如，有一个商品的标题为“碗装保温饭盒套装”，通过Term Weight可以得到核心词为“饭盒”。
```

##### 2  规则解析法

这种方法比较适用于查询非常符合规则的类别，通过规则解析的方式来获取查询的意图。比如：
北京到上海今天的机票价格，可以转换为[地点]到[地点] [日期]  [汽车票/机票/火车票] [价格]。
1吨等于多少公斤，可以转换为[数字] [计量单位]等于[数字] [计量单位]。

##### 3 机器学习方法

意图识别其实可以看做是一个分类问题，采用机器学习或者文本分类方法，

可以统计出每种意图类别下面的常用词。【例如电商可以统计出类目词，产品词，品牌词，型号词，季节时间词，促销词等等】，例如：  地址(澳洲)，品牌词(爱他美)，产品词(奶粉)，属性词(三段)

对于用户输入的query，根据统计分类模型计算出每一个意图的概率，最终给出查询的意图。

##### 4 深度学习方法

文本特征+实时、离线用户本身的行为+用户本身相关的特征，通过深度学习方案构建模型，对用户意图进行预测。 

整体的基本技术思路就是将行为因子与文本特征分别进行 Embedding 处理，通过向量叠加之后再进行多分类或者二分类处理。 



#### 2.2.2 意图识别结果

意图识别之后，我们能够得到3类问题，根据类别采用不同的决策，如果是任务型的，可以分配到具体的任务意图处理。

**a) 问答型**：例如“密码忘记怎么办？”→ 采用基于知识图谱构建 + 检索模型匹配方式

**b) 任务型**：例如“我想订一张明天从杭州到北京的机票”→ 意图决策 +slots filling 的匹配方式

**c) 语聊型**：例如“我心情不好”→ 检索模型与 Deep Learning 相结合的方式

比如某聊天机器人目前只有30个技能，那么用户向聊天机器人发出一个指令，聊天机器人首先得根据意图识别将用户的query分到某一个或者某几个技能上去，然后再进行后续的处理 



#### 2.2.3 问答型问题解决方案

问答型问题处理有两种，检索模型和深度学习模型。

##### 检索模型基本处理过程

1、预处理 query ->分词-> 纠错->标准化->文本特征提取->query改写[同义词] 

2、BM25 算法召回

3、计算语句和候选句的相似度s(q,q') , 并排序

4、排序调整

```
例子 搜“辣鸡面”，产品词是“面”
1、有一个商品的标题是”AYAM BRAND 雄鸡标 辣椒金枪鱼“，它的类目是“冷面/熟食/方便菜 其他熟食”，单字召回。
2、通过实体识别会得到这个商品的产品词是“金枪鱼”，而query要搜的产品词是“面”。这样就可以判断出其实这是一个误召回，进而可以将这个商品进行过滤或者是排序的时候放到较后的位置。
```

##### 深度学习deepQA的基本处理过程

1、query -> 分词->纠错->标准化->文本特征提取->query改写[同义词]

2、命名实体识别

3、再进行用户意图识别

4、根据用户意图，当前轨迹，当前问题，检索答案候选集，生成问题-答案对

5、特征抽取，计算问题答案相似度

6、提取相似度最高的问题答案

DeepQA实质上就是从海量的候选集合里面筛选符合用户问题的答案，包括京东主站大部分商品单品页的大量商品咨询数据、京东咚咚上的用户与客服的海量历史聊天日志、网页抓取的各种闲聊问答对、人工编辑的高频FAQ问答对等场景。 



##### 阿里小蜜的解决方案=知识图谱构建 +检索模型匹配方式

 特点：有领域知识的概念，且知识之间的关联性高，并且对精准度要求比较高.

 知识图谱的构建: 一个是实体维度的挖掘，一个是短句维度进行挖掘，通过在淘宝平台上积累的大量属于以及互联网数据，通过主题模型的方式进行挖掘、标注与清洗，再通过预设定好的关系进行实体之间关系的定义最终形成知识图谱。 

![1605782542417](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/1605782542417.png)

 基于知识图谱的匹配模式具备如下优点:

(1). 在对话结构和流程的设计中支持实体间的上下文会话识别与推理

(2). 通常在一般型问答的准确率相对比较高 (当然具备推理型场景的需要特殊的设计，会有些复杂)

明显的缺点：

(1). 模型构建初期可能会存在数据的松散和覆盖率问题，导致匹配的覆盖率缺失

(2). 对于知识图谱增量维护相比传统的 QA Pair 对知识的维护上的成本会更大一些；



在阿里小蜜的问答型设计中，还是融入了传统的基于检索模型的对话匹配 ，其在线基本流程分为：

(1). 提问预处理：分词、指代消解、纠错等基本文本处理流程；

(2). 检索召回：通过检索的方式在候选数据中召回可能的匹配候选数据；

(3). 计算：通过 Query 结合上下文模型与候选数据进行计算，通过我们采用文本之间的距离计算方式 (余弦相似度、编辑距离) 以及分类模型相结合的方式进行计算；

(4). 最终根据返回的候选集打分阈值进行最终的产品流程设计；

 检索模型整体流程如下图：

 ![1605783240404](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/1605783240404.png)

#### 2.2.4 任务型问题解决方案=意图决策 + slots  filling 

 特点：有领域知识的概念，每个任务负责独立的业务流程，任务之间相对互斥性强，精准度要求高。 

首先按照任务领域进行本体知识的构建，例如机票的领域本体知识场景如下：

![img](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/c1724f6c069e789c82b19bba805e1858.png)

在问答匹配过程中结合上下文模型和领域数据模型不断在 Query 中进行 slot 属性的提取，并循环进行本体意图树的不断填充和修改，直到必选意图树填充完整后进行输出。如下图：

![img](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/b1202630db92fd0f5a9e42f921707746.png)

#### 2.2.5 语聊型问题解决方案

特点：非面向目标，语义意图不明确，通常期待的是语义相关性和渐进性，对准确率要求相对较低

面向 open domain 的聊天机器人目前无论在学术界还是在工业界都是一大难题，通常在目前这个阶段我们有两种方式来做对话设计：

##### 1、seq2seq- Deep Learning 生成模型方式

通过 Encoder-Decoder 模型通过 LSTM 的方式进行 Sequence to Sequence 生成，如下图：

![img](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/8926ead4599ab5fd1fb8e55765b838a7.png)

Generation Model(生成模型)：

优点：通过深层语义方式进行答案生成，答案不受语料库规模限制

缺点：模型的可解释性不强，且难以保证一致性和合理性回答

##### 2、Retrieval Model(检索模型)：

优点：答案在预设的语料库中，可控，匹配模型相对简单，可解释性强

缺点：在一定程度上缺乏一些语义性，且有固定语料库的局限性



##### 3 阿里小蜜的方法

在阿里小蜜的聊天引擎中，先通过传统的检索模型检索出候选集数据，然后采用 Attentive Seq2Seq Rerank Model对候选答案集进行标准化评分，重排序后超过阈值就进行输出，不到阈值，就通过 Seq2Seq Model 进行答案生成 



![1605783627312](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/1605783627312.png)



#### 2.2.6 相似度问题求解

##### 冷启动解决方案

字面匹配 文本相似度（jaccard, cosine)+ xgboost

词向量 word2vec,glove =Global Vectors for Word Representation
句向量 WMD[无监督] ,SIF 

```
SIF 
1、以smooth inverse frequency（简称SIF)为权重，对所有词的word vector加权平均
  例如权重=a/(a + p(w))，最后从中减掉重要关键词，得到sentence embedding。
2、对一些不重要的词语的权重下降，例如but、just等
```

##### 排序训练

 排序阶段也可以利用排序训练模型，得到知识库内的相似问，构造句对训练数据，训练有监督的模型
判断(query, question)的分数，选择分数最高的问题对应的知识点作为机器人回复.

##### 深度学习语义匹配

DSSM（Deep Structured Semantic Models）: 通过Query 和 答案日志，用 DNN 把 Query 和 Title 表达为低纬语义向量，并通过 cosine 距离来计算两个语义向量的距离，最终训练出语义相似度模型。该模型既可以用来预测两个句子的语义相似度

#### 2.2.7 对话策略学习

采用强化学习,进行对话策略的在线学习。通过结合端到端模型来实现对话策略的灵活调整，并且能够实现在线学习，使得多轮对话模型可以持续优化。

#### 2.2.8 多轮会话

智能客服对话流程

 

![1604659288462](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/1604659288462.png)



多轮会话流程包括：

​           1、对query进行nlu意图识别/槽位提取

​                  基于分类维护一个意图堆，确定意图边界和具体的意图切换和修改逻辑，互斥，相似，上下位                   在多轮交互中用户会不断的添加或修改意图的子意图，需要维护一份当前识别的意图集合

​           2、 DST会话状态管理

​           3、DPL会话策略学习 ，对当前对话状态下每一句回复进行评估，每次选择具有最大累计价值而不仅仅是生成概率最高的句子，利用强化学习最大化未来累计奖励的特点，建模多轮对话的过程，使得当前回复有利于对话过程的持续进行，以缓解多轮对话过程中容易出现的生成大量万能回复以及很快陷入死循环的问题。

​           4、NLG- 根据action 返回回复文本 

应用：

任务型机器人:   通过识别意图，引导完成特定任务， 查流量，查话费，订餐，订票，咨询等任务型场景

知识图谱机器人： 选择场景，实体抽取，实体存储，关系预测，根据知识逐步给出答案  

### 2.3 知识维护系统

包含知识库的编辑，知识图谱的完善，以及规则和模板的编辑管理。

### 2.4 模型训练

包含原始数据的提取，用户信息的提取，训练模型等功能。



## 三、扩展应用

#### 3.1 无咨询问题引导

 **预判** 客服机器人多轮对话的意图预判功能通常依赖于访客的接入渠道、着陆页、访问轨迹等数据，机器人可以通过这些数据来预测客户想要咨询的问题 

1、按热门维度，收集咨询的问题。

2、可以用文本分类训练一个语料过滤模型，用于数据清洗。

3、问题做切词，word2vec训练词向量，进而得到句子向量，最终用K-means聚类的方法，找到最大的Cluster，选出现次数最多的问题作为标准问题。

4、系统上线后,先随机出这些问题，然后根据用户点击行为确定样本的标签，再收集用户的订单、服务单、实时浏览数据、以及画像数据作为样本，最终训练一个用于用户开始咨询前的未来意图预测分类模型。当用户再来咨询时，根据分类模型给出用户最可能问到的前3个问题，供其点选。



 深度学习CNN模型，可用于求解一个分类问题，将用户的问题映射到一个具体的分类。最终在算法选型上，我们采用深度学习CNN模型，其中模型参数：
词向量采用100维
每个样本限定30个字以内，超出30截断，不足30补充随机向量
单层CNN网络，第一层卷积核大小3*50 

 ![image.png](%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D/10553589-3b1e8b5da9f290df.png) 





#### 3.2 无答案问题引导

下面的例子是搜索query例子，但是也可以引入智能问答的的无答案问题引导

相似词扩展：学步鞋-宝宝鞋
删除修饰词：卡乐比水果麦片 -> 水果麦片
类目相关：     搜索adidas 统计得到 “Adidas”对应的类目相关性排序为：运动鞋>衣服>沐浴露。
“男士面膜”/”女士面膜”/”面膜粉”/“孕妇面膜”  离线将这四个类目归一为一个虚拟类目，当用户的query落在虚拟类目中的大部分类目时，问题也具有相关性。

用户说每句话时，可以实时预测用户下一意图。







#### 3.3 电话拨打机器人

##### 基础技术

ASR语音识别, 

NLP自然语言理解

TTS语音合成

MRCP  媒体资源控制协议(Media Resource Control Protocol, *MRCP*)

呼叫中心

##### 智能电话管理

人群管理[企业意向用户]

话术管理[话术模板配置]

电话任务管理

知识库管理

算法模型管理【关键词-意图识别-知识图谱】

##### 外呼统计

任务监控，通话监控，意向度筛选，通话详情，统计分析

##### 智能应答 

应答管理，应答统计





## 四、交互优化

#### 背景

最早，纯粹通过运营机器人知识，我们承接了基本的问答场景。但深入运营后发现，单纯依靠算法、知识语料的调优，效果提升越来越不明显。有时，新增几万或几百万的数据带来的收益，也仅提升了一两个点。

#### **对话体验优化**  

1、会话前，进行用户轨迹和风险识别。

2、会话中，制定了对话健康度的评判体系， 一旦AI监测到这段会话可能存在走偏、答错、用户情绪异常等情况，便会由人工实时介入处理。

3、会话中，试图锁定了意图[退货?]和状态[未发货] ，确定语境

在一个确定语境下，机器人可以实现记忆，智能反问（问题预测），缩短用户命中问题的路径，避免出现传统机器人答非所问、前后文不符的情况。语境的引入，营造了多轮且连贯的对答效果。 

4、答案体现 “帮到底”原则

举个例子，每天都会有很多用户来咨询微信支付绑定银行卡失败的问题。之前，机器人只会简单引导用户去找银行解决。

现在，机器人不仅为用户查询该银行电话，还会展示地图中附近的银行网点，并教用户联系银行后怎么办。



5、机器人赋予人设，声优选择

​     在游戏客服中，让角色声优为答案进行配音，这样不仅保证了服务效果，还能提升用户好感度。  





##  五、研究方向

深度语义匹配论文复现，调优和工程实践。 

迁移学习的策略解决语料不足

使用知识图谱来补全 FAQ 机器人的问答死角

阅读理解：从文章中抽取答案，阅读理解建模

seq2seq： 上下文建模

情感分析： 文本分类问题

规则模型的结合













